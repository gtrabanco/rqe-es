TODO:
There are a lot of spaggeti code.